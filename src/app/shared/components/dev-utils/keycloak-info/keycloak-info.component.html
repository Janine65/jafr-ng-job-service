<div class="p-4">
    <!-- User Profile Card -->
    <p-card class="mb-4">
        <ng-template pTemplate="header">
            <div class="p-3">
                <h3 class="m-0">User Profile</h3>
            </div>
        </ng-template>
        <div class="grid">
            <div class="col-12 md:col-6">
                <div class="field">
                    <label class="font-semibold text-sm text-600">Username</label>
                    <p class="mt-2 text-sm">{{ userProfile?.username || 'N/A' }}</p>
                </div>
            </div>
            <div class="col-12 md:col-6">
                <div class="field">
                    <label class="font-semibold text-sm text-600">Email</label>
                    <p class="mt-2 text-sm">{{ userProfile?.email || 'N/A' }}</p>
                </div>
            </div>
            <div class="col-12 md:col-6">
                <div class="field">
                    <label class="font-semibold text-sm text-600">First Name</label>
                    <p class="mt-2 text-sm">{{ userProfile?.firstName || 'N/A' }}</p>
                </div>
            </div>
            <div class="col-12 md:col-6">
                <div class="field">
                    <label class="font-semibold text-sm text-600">Last Name</label>
                    <p class="mt-2 text-sm">{{ userProfile?.lastName || 'N/A' }}</p>
                </div>
            </div>
            <div class="col-12 md:col-6">
                <div class="field">
                    <label class="font-semibold text-sm text-600">Email Verified</label>
                    <p class="mt-2 text-sm">
                        <span *ngIf="userProfile?.emailVerified" class="text-green-600"> <i class="pi pi-check-circle"></i> Yes </span>
                        <span *ngIf="!userProfile?.emailVerified" class="text-orange-600"> <i class="pi pi-times-circle"></i> No </span>
                    </p>
                </div>
            </div>
            <div class="col-12 md:col-6">
                <div class="field">
                    <label class="font-semibold text-sm text-600">User ID</label>
                    <p class="mt-2 text-sm font-mono text-600">{{ userProfile?.id || 'N/A' }}</p>
                </div>
            </div>
        </div>
    </p-card>

    <!-- Roles Card -->
    <p-card class="mb-4">
        <ng-template pTemplate="header">
            <div class="flex align-items-center gap-2 p-3">
                <h3 class="m-0">User Roles</h3>
                <p-badge [value]="roles.length.toString()" severity="info"></p-badge>
            </div>
        </ng-template>
        <div class="flex flex-wrap gap-2" *ngIf="roles && roles.length > 0">
            <p-chip *ngFor="let role of roles" [label]="role" class="bg-primary-100 text-primary-900"></p-chip>
        </div>
        <p *ngIf="!roles || roles.length === 0" class="text-600">No roles assigned</p>
    </p-card>

    <!-- Token Information Card -->
    <p-card class="mb-4">
        <ng-template pTemplate="header">
            <div class="p-3">
                <h3 class="m-0">Token Information</h3>
            </div>
        </ng-template>

        <div class="grid">
            <!-- Parsed Access Token Claims -->
            <div class="col-12">
                <h4 class="mb-3 text-primary">Access Token Claims</h4>
                <div class="grid" *ngIf="parsedAccessToken">
                    <div class="col-12 md:col-6">
                        <div class="field">
                            <label class="font-semibold text-sm text-600">Subject (sub)</label>
                            <p class="mt-2 text-sm font-mono">{{ parsedAccessToken.sub || 'N/A' }}</p>
                        </div>
                    </div>
                    <div class="col-12 md:col-6">
                        <div class="field">
                            <label class="font-semibold text-sm text-600">Preferred Username</label>
                            <p class="mt-2 text-sm">{{ parsedAccessToken['preferred_username'] || 'N/A' }}</p>
                        </div>
                    </div>
                    <div class="col-12 md:col-6">
                        <div class="field">
                            <label class="font-semibold text-sm text-600">Issued At</label>
                            <p class="mt-2 text-sm">{{ formatTimestamp(parsedAccessToken.iat) }}</p>
                        </div>
                    </div>
                    <div class="col-12 md:col-6">
                        <div class="field">
                            <label class="font-semibold text-sm text-600">Expires At</label>
                            <p class="mt-2 text-sm" [class.text-red-600]="isExpired(parsedAccessToken.exp)">
                                {{ formatTimestamp(parsedAccessToken.exp) }}
                                <span *ngIf="isExpired(parsedAccessToken.exp)" class="ml-2"> <i class="pi pi-exclamation-triangle"></i> Expired </span>
                            </p>
                        </div>
                    </div>
                    <div class="col-12 md:col-6">
                        <div class="field">
                            <label class="font-semibold text-sm text-600">Issuer</label>
                            <p class="mt-2 text-sm font-mono text-600">{{ parsedAccessToken.iss || 'N/A' }}</p>
                        </div>
                    </div>
                    <div class="col-12 md:col-6">
                        <div class="field">
                            <label class="font-semibold text-sm text-600">Audience</label>
                            <p class="mt-2 text-sm font-mono text-600">{{ parsedAccessToken.aud || 'N/A' }}</p>
                        </div>
                    </div>
                    <div class="col-12" *ngIf="parsedAccessToken?.realm_access?.roles">
                        <div class="field">
                            <label class="font-semibold text-sm text-600">Realm Roles</label>
                            <div class="flex flex-wrap gap-2 mt-2">
                                <p-chip *ngFor="let role of parsedAccessToken?.realm_access?.roles" [label]="role" class="bg-blue-100 text-blue-900" size="small"></p-chip>
                            </div>
                        </div>
                    </div>
                </div>
            </div>

            <div class="col-12">
                <p-divider></p-divider>
            </div>

            <!-- Raw JWT Tokens - Collapsed by default -->
            <div class="col-12">
                <h4 class="mb-3 text-primary">JWT Tokens</h4>

                <!-- Access Token -->
                <div class="mb-4">
                    <div class="flex justify-content-between align-items-center mb-2">
                        <label class="font-semibold text-sm text-600">Access Token</label>
                        <div>
                            <p-button icon="pi pi-eye" [label]="showAccessToken ? 'Hide' : 'Show'" (click)="showAccessToken = !showAccessToken" class="p-button-text p-button-sm" [severity]="showAccessToken ? 'secondary' : 'info'"> </p-button>
                            <p-button *ngIf="showAccessToken" icon="pi pi-copy" label="Copy" (click)="copyToClipboard(accessToken)" class="p-button-text p-button-sm ml-2" severity="success"> </p-button>
                        </div>
                    </div>
                    <pre *ngIf="showAccessToken" class="token-pre bg-gray-100 p-3 border-round">{{ accessToken }}</pre>
                </div>

                <!-- Refresh Token -->
                <div class="mb-3" *ngIf="refreshToken">
                    <div class="flex justify-content-between align-items-center mb-2">
                        <label class="font-semibold text-sm text-600">Refresh Token</label>
                        <div>
                            <p-button icon="pi pi-eye" [label]="showRefreshToken ? 'Hide' : 'Show'" (click)="showRefreshToken = !showRefreshToken" class="p-button-text p-button-sm" [severity]="showRefreshToken ? 'secondary' : 'info'"> </p-button>
                            <p-button *ngIf="showRefreshToken" icon="pi pi-copy" label="Copy" (click)="copyToClipboard(refreshToken)" class="p-button-text p-button-sm ml-2" severity="success"> </p-button>
                        </div>
                    </div>
                    <pre *ngIf="showRefreshToken" class="token-pre bg-gray-100 p-3 border-round">{{ refreshToken }}</pre>
                </div>
            </div>
        </div>
    </p-card>
</div>

<style>
    .token-pre {
        white-space: pre-wrap;
        word-break: break-all;
        font-size: 0.75rem;
        max-height: 300px;
        overflow-y: auto;
    }
</style>
