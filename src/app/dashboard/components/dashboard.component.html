<div class="dashboard-container">
    <div *ngIf="isLoading" class="space-y-6">
        <!-- Simple Loading skeleton -->
        <p-card class="greeting-card">
            <div class="p-4">
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <p-skeleton shape="circle" size="3rem"></p-skeleton>
                        <p-skeleton width="200px" height="2rem"></p-skeleton>
                    </div>
                    <p-skeleton width="150px" height="1rem"></p-skeleton>
                </div>
                <div class="mb-4">
                    <p-skeleton height="4rem" class="mb-3"></p-skeleton>
                    <p-skeleton height="4rem"></p-skeleton>
                </div>
                <div class="text-center">
                    <p-skeleton width="150px" height="2.5rem"></p-skeleton>
                </div>
            </div>
        </p-card>

        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-6">
            <p-card *ngFor="let item of [1, 2, 3]">
                <p-skeleton height="2rem" class="mb-4"></p-skeleton>
                <p-skeleton height="4rem"></p-skeleton>
            </p-card>
        </div>
    </div>

    <div *ngIf="!isLoading && dashboardData" class="space-y-6">
        <!-- Simple User Greeting Card -->
        <p-card class="greeting-card">
            <div class="p-4">
                <!-- Simple Greeting with Avatar -->
                <div class="flex items-center justify-between mb-4">
                    <div class="flex items-center space-x-3">
                        <p-avatar [label]="getInitials(dashboardData.userDisplayName || 'Benutzer')" class="user-avatar" size="large"> </p-avatar>
                        <h1 class="text-2xl font-bold text-gray-900 dark:text-white">{{ getGreetingMessage() }} {{ dashboardData.userDisplayName || 'Benutzer' }}</h1>
                    </div>
                    <p class="text-gray-600 dark:text-gray-400">
                        {{ getCurrentDateText() }}
                    </p>
                </div>

                <!-- What's New Section (if exists) -->
                <div *ngIf="hasWhatsNew()" class="whats-new-section mb-4">
                    <div class="flex items-center justify-between mb-3">
                        <h3 class="text-lg font-semibold text-gray-800 dark:text-gray-200 flex items-center">
                            <i class="pi pi-sparkles text-primary mr-2"></i>
                            Was ist neu?
                        </h3>
                        <button class="text-gray-500 hover:text-gray-700 dark:text-gray-400 dark:hover:text-gray-200 p-1 rounded" (click)="dismissWhatsNew()" title="Schließen">
                            <i class="pi pi-times"></i>
                        </button>
                    </div>

                    <div class="space-y-3">
                        <div *ngFor="let item of dashboardData.whatsNew.slice(0, 2)" class="flex items-start space-x-2 p-2 bg-blue-50 dark:bg-blue-900/20 rounded-lg">
                            <div class="w-6 h-6 bg-primary text-white rounded flex items-center justify-center flex-shrink-0">
                                <i [class]="getWhatsNewIcon(item.category)" class="text-xs"></i>
                            </div>
                            <div class="flex-1">
                                <div class="flex items-center space-x-2 mb-1">
                                    <h4 class="text-sm font-medium text-gray-900 dark:text-white">{{ item.title }}</h4>
                                    <span *ngIf="item.important" class="bg-orange-500 text-white text-xs px-1.5 py-0.5 rounded-full"> Wichtig </span>
                                </div>
                                <p class="text-xs text-gray-600 dark:text-gray-400 mb-1">{{ item.description }}</p>
                                <div class="text-xs text-gray-500 dark:text-gray-500 opacity-75">v{{ item.version }} • {{ item.date | date: 'shortDate' }}</div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        </p-card>

        <!-- Responsive Grid: Max 3 columns using Tailwind only -->
        <div class="grid grid-cols-1 md:grid-cols-2 xl:grid-cols-3 gap-4">
            <!-- Service Cards -->
            <ng-container *ngIf="dashboardData.permissions.canViewJobs">
                <ng-container *ngFor="let service of dashboardData.availableServices">
                    <app-service-card [asyncState]="getServiceState(service.name)" [serviceData]="getServiceState(service.name)?.data" [permissions]="dashboardData.permissions" (navigateToService)="navigateToService($event)"></app-service-card>
                </ng-container>
            </ng-container>

            <!-- Offerten Card - DEACTIVATED -->
            <!-- <app-offerte-section
                *ngIf="dashboardData.permissions.canViewOfferten"
                [offerten]="dashboardData.recentOfferten"
                [permissions]="dashboardData.permissions"
                (navigateToOfferteCreation)="navigateToOfferteCreation()"
                (navigateToOfferteSearch)="navigateToOfferteSearch()"
                (navigateToOfferteDetail)="navigateToOfferteDetail($event)"
            ></app-offerte-section> -->
        </div>
    </div>

    <div *ngIf="!isLoading && !dashboardData" class="text-center py-12">
        <i class="pi pi-exclamation-triangle text-4xl text-red-500 mb-4"></i>
        <h2 class="text-xl font-semibold text-gray-900 dark:text-white mb-2">Fehler beim Laden des Dashboards</h2>
        <p class="text-gray-600 dark:text-gray-400 mb-4">Die Dashboard-Daten konnten nicht geladen werden.</p>
        <p-button label="Erneut versuchen" icon="pi pi-refresh" (onClick)="loadDashboard()" severity="secondary"> </p-button>
    </div>
</div>
