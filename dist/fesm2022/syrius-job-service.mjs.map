{"version":3,"file":"syrius-job-service.mjs","sources":["../../src/lib/config/job-tokens.ts","../../src/lib/stores/dynamic-job.store.ts","../../src/lib/stores/job.store.ts","../../src/lib/services/job-base.service.ts","../../src/lib/services/job-state.service.ts","../../src/lib/services/job-polling.service.ts","../../src/lib/components/job-details/job-details.component.ts","../../src/lib/components/job-details/job-details.component.html","../../src/public-api.ts","../../src/syrius-job-service.ts"],"sourcesContent":["import { InjectionToken } from '@angular/core';\n\n// Re-export logger token from services for convenience (optional dependency)\nexport { JOB_LOGGER_FACTORY } from \"../services/job-base.service\";\nexport type {\n  LoggerInterface,\n  LoggerFactoryInterface,\n} from \"../services/job-base.service\";\n\n/**\n * Configuration token for job service settings\n */\nexport interface JobLibraryConfig {\n  /** Default polling interval in milliseconds for completed jobs (default: 600000ms = 10 minutes) */\n  defaultPollingInterval?: number;\n  /** Polling interval for running jobs in milliseconds (default: 30000ms = 30 seconds) */\n  runningJobsPollingInterval?: number;\n  /** Enable debug logging */\n  enableDebugLogging?: boolean;\n  /** API base URL */\n  apiBaseUrl?: string;\n}\n\nexport const JOB_LIBRARY_CONFIG = new InjectionToken<JobLibraryConfig>(\n  \"JOB_LIBRARY_CONFIG\"\n);\n","import { computed, Injectable, signal } from \"@angular/core\";\n\nimport { JobProgress } from \"../services/job-base.service\";\n\n/**\n * Job type identifier for categorizing different job workflows\n * Fully dynamic - any string can be used as job type\n */\nexport type JobType = string;\n\n/**\n * State for a specific job type containing running and completed jobs\n */\nexport interface JobTypeState {\n  running: JobProgress[];\n  completed: JobProgress[];\n  loading: boolean;\n  error: string | null;\n}\n\n/**\n * Root job state containing all job types\n * Fully dynamic - job types are added at runtime\n */\nexport type JobState = Record<JobType, JobTypeState>;\n\n/**\n * Initial state for a single job type\n */\nconst initialJobTypeState: JobTypeState = {\n  running: [],\n  completed: [],\n  loading: false,\n  error: null,\n};\n\n/**\n * Session storage key for job state persistence\n */\nconst STORAGE_KEY = \"job_state\";\n\n/**\n * Dynamic Job Store using Angular Signals\n *\n * Fully dynamic store that can handle any job type at runtime.\n * No hardcoded job types - everything is registered dynamically.\n */\n@Injectable({\n  providedIn: \"root\",\n})\nexport class DynamicJobStore {\n  // Internal reactive state\n  private state = signal<JobState>(this.loadFromStorage());\n\n  // Computed selectors\n  readonly allRunningJobs = computed(() => {\n    const result: Record<JobType, JobProgress[]> = {};\n    const currentState = this.state();\n    Object.keys(currentState).forEach((jobType) => {\n      result[jobType] = currentState[jobType].running;\n    });\n    return result;\n  });\n\n  readonly allCompletedJobs = computed(() => {\n    const result: Record<JobType, JobProgress[]> = {};\n    const currentState = this.state();\n    Object.keys(currentState).forEach((jobType) => {\n      result[jobType] = currentState[jobType].completed;\n    });\n    return result;\n  });\n\n  readonly totalRunningJobsCount = computed(() => {\n    const currentState = this.state();\n    return Object.values(currentState).reduce(\n      (total, jobTypeState) => total + jobTypeState.running.length,\n      0\n    );\n  });\n\n  readonly totalCompletedJobsCount = computed(() => {\n    const currentState = this.state();\n    return Object.values(currentState).reduce(\n      (total, jobTypeState) => total + jobTypeState.completed.length,\n      0\n    );\n  });\n\n  /**\n   * Get running jobs for a specific job type\n   */\n  runningJobs(jobType: JobType) {\n    return computed(() => {\n      const currentState = this.state();\n      return currentState[jobType]?.running || [];\n    });\n  }\n\n  /**\n   * Get completed jobs for a specific job type\n   */\n  completedJobs(jobType: JobType) {\n    return computed(() => {\n      const currentState = this.state();\n      return currentState[jobType]?.completed || [];\n    });\n  }\n\n  /**\n   * Get all jobs (running + completed) for a specific job type\n   */\n  allJobs(jobType: JobType) {\n    return computed(() => {\n      const currentState = this.state();\n      const jobTypeState = currentState[jobType];\n      if (!jobTypeState) return [];\n      return [...jobTypeState.running, ...jobTypeState.completed];\n    });\n  }\n\n  /**\n   * Get loading state for a specific job type\n   */\n  loading(jobType: JobType) {\n    return computed(() => {\n      const currentState = this.state();\n      return currentState[jobType]?.loading || false;\n    });\n  }\n\n  /**\n   * Get error for a specific job type\n   */\n  error(jobType: JobType) {\n    return computed(() => {\n      const currentState = this.state();\n      return currentState[jobType]?.error || null;\n    });\n  }\n\n  /**\n   * Get running jobs count for a specific job type\n   */\n  runningJobsCount(jobType: JobType) {\n    return computed(() => {\n      const currentState = this.state();\n      return currentState[jobType]?.running.length || 0;\n    });\n  }\n\n  /**\n   * Get completed jobs count for a specific job type\n   */\n  completedJobsCount(jobType: JobType) {\n    return computed(() => {\n      const currentState = this.state();\n      return currentState[jobType]?.completed.length || 0;\n    });\n  }\n\n  /**\n   * Ensure job type exists in state\n   */\n  private ensureJobType(jobType: JobType): void {\n    const currentState = this.state();\n    if (!currentState[jobType]) {\n      this.state.update((state) => ({\n        ...state,\n        [jobType]: { ...initialJobTypeState },\n      }));\n    }\n  }\n\n  /**\n   * Set running jobs for a specific job type\n   */\n  setRunningJobs(jobType: JobType, jobs: JobProgress[]): void {\n    this.ensureJobType(jobType);\n    this.state.update((state) => ({\n      ...state,\n      [jobType]: {\n        ...state[jobType],\n        running: jobs,\n        loading: false,\n        error: null,\n      },\n    }));\n    this.saveToStorage();\n  }\n\n  /**\n   * Set completed jobs for a specific job type\n   */\n  setCompletedJobs(jobType: JobType, jobs: JobProgress[]): void {\n    this.ensureJobType(jobType);\n    this.state.update((state) => ({\n      ...state,\n      [jobType]: {\n        ...state[jobType],\n        completed: jobs,\n        loading: false,\n        error: null,\n      },\n    }));\n    this.saveToStorage();\n  }\n\n  /**\n   * Add a new running job\n   */\n  addRunningJob(jobType: JobType, job: JobProgress): void {\n    this.ensureJobType(jobType);\n    this.state.update((state) => ({\n      ...state,\n      [jobType]: {\n        ...state[jobType],\n        running: [...state[jobType].running, job],\n      },\n    }));\n    this.saveToStorage();\n  }\n\n  /**\n   * Update a specific job (searches in both running and completed)\n   */\n  updateJob(jobType: JobType, job: JobProgress): void {\n    this.ensureJobType(jobType);\n    this.state.update((state) => {\n      const currentJobState = state[jobType];\n      const runningIndex = currentJobState.running.findIndex(\n        (j) => j.id === job.id\n      );\n      const completedIndex = currentJobState.completed.findIndex(\n        (j) => j.id === job.id\n      );\n\n      if (runningIndex !== -1) {\n        const updatedRunning = [...currentJobState.running];\n        updatedRunning[runningIndex] = job;\n        return {\n          ...state,\n          [jobType]: {\n            ...currentJobState,\n            running: updatedRunning,\n          },\n        };\n      } else if (completedIndex !== -1) {\n        const updatedCompleted = [...currentJobState.completed];\n        updatedCompleted[completedIndex] = job;\n        return {\n          ...state,\n          [jobType]: {\n            ...currentJobState,\n            completed: updatedCompleted,\n          },\n        };\n      }\n      return state;\n    });\n    this.saveToStorage();\n  }\n\n  /**\n   * Move a job from running to completed\n   */\n  moveJobToCompleted(jobType: JobType, jobId: string): void {\n    this.ensureJobType(jobType);\n    this.state.update((state: JobState) => {\n      const currentJobState = state[jobType];\n      const jobIndex = currentJobState.running.findIndex(\n        (j: JobProgress) => j.id === jobId\n      );\n\n      if (jobIndex !== -1) {\n        const job = currentJobState.running[jobIndex];\n        const updatedRunning = currentJobState.running.filter(\n          (j: JobProgress) => j.id !== jobId\n        );\n        const updatedCompleted = [job, ...currentJobState.completed];\n\n        return {\n          ...state,\n          [jobType]: {\n            ...currentJobState,\n            running: updatedRunning,\n            completed: updatedCompleted,\n          },\n        };\n      }\n      return state;\n    });\n    this.saveToStorage();\n  }\n\n  /**\n   * Remove a job from running jobs\n   */\n  removeRunningJob(jobType: JobType, jobId: string): void {\n    this.ensureJobType(jobType);\n    this.state.update((state: JobState) => ({\n      ...state,\n      [jobType]: {\n        ...state[jobType],\n        running: state[jobType].running.filter(\n          (j: JobProgress) => j.id !== jobId\n        ),\n      },\n    }));\n    this.saveToStorage();\n  }\n\n  /**\n   * Clear all jobs for a specific job type\n   */\n  clearJobs(jobType: JobType): void {\n    this.state.update((state: JobState) => ({\n      ...state,\n      [jobType]: { ...initialJobTypeState },\n    }));\n    this.saveToStorage();\n  }\n\n  /**\n   * Clear all jobs (all types)\n   */\n  clearAllJobs(): void {\n    this.state.set({});\n    this.saveToStorage();\n  }\n\n  /**\n   * Set loading state for a job type\n   */\n  setLoading(jobType: JobType, loading: boolean): void {\n    this.ensureJobType(jobType);\n    this.state.update((state: JobState) => ({\n      ...state,\n      [jobType]: {\n        ...state[jobType],\n        loading,\n      },\n    }));\n  }\n\n  /**\n   * Set error for a job type\n   */\n  setError(jobType: JobType, error: string | null): void {\n    this.ensureJobType(jobType);\n    this.state.update((state: JobState) => ({\n      ...state,\n      [jobType]: {\n        ...state[jobType],\n        error,\n        loading: false,\n      },\n    }));\n  }\n\n  /**\n   * Load state from sessionStorage\n   */\n  private loadFromStorage(): JobState {\n    try {\n      const stored = sessionStorage.getItem(STORAGE_KEY);\n      if (stored) {\n        const parsed = JSON.parse(stored) as JobState;\n        // Convert date strings back to Date objects\n        Object.values(parsed).forEach((jobTypeState) => {\n          jobTypeState.running.forEach((job: JobProgress) => {\n            job.startTime = new Date(job.startTime);\n            if (job.endTime) job.endTime = new Date(job.endTime);\n          });\n          jobTypeState.completed.forEach((job: JobProgress) => {\n            job.startTime = new Date(job.startTime);\n            if (job.endTime) job.endTime = new Date(job.endTime);\n          });\n        });\n        return parsed;\n      }\n    } catch (error) {\n      console.error(\n        \"[DynamicJobStore] Failed to load state from storage:\",\n        error\n      );\n    }\n    return {};\n  }\n\n  /**\n   * Save state to sessionStorage\n   */\n  private saveToStorage(): void {\n    try {\n      sessionStorage.setItem(STORAGE_KEY, JSON.stringify(this.state()));\n    } catch (error) {\n      console.error(\n        \"[DynamicJobStore] Failed to save state to storage:\",\n        error\n      );\n    }\n  }\n\n  /**\n   * Clear all persisted state from sessionStorage\n   */\n  clearPersistedState(): void {\n    try {\n      sessionStorage.removeItem(STORAGE_KEY);\n      this.state.set({});\n    } catch (error) {\n      console.error(\n        \"[DynamicJobStore] Failed to clear persisted state:\",\n        error\n      );\n    }\n  }\n}\n\n// Re-export as JobStore for compatibility\nexport const JobStore = DynamicJobStore;\n","// Re-export the dynamic job store as the main JobStore\nexport { \n  DynamicJobStore as JobStore\n} from './dynamic-job.store';\n\nexport type { \n  JobType, \n  JobTypeState, \n  JobState \n} from './dynamic-job.store';\n","import {\n    BehaviorSubject, Observable, of, Subject, Subscription, take, takeUntil, throwError, timer\n} from 'rxjs';\nimport { catchError, map, switchMap, tap } from 'rxjs/operators';\n\nimport { HttpClient, HttpHeaders } from '@angular/common/http';\nimport { inject, InjectionToken, NgZone } from '@angular/core';\nimport { toObservable } from '@angular/core/rxjs-interop';\nimport { TranslateService } from '@ngx-translate/core';\n\nimport { JOB_LIBRARY_CONFIG, JobLibraryConfig } from '../config/job-tokens';\nimport { JobStore, JobType } from '../stores/job.store';\n\n// Local interfaces for the library\nexport interface JobProgress {\n  id: string;\n  name: string;\n  status: \"running\" | \"completed\" | \"failed\";\n  progress: number;\n  total: number;\n  processed: number;\n  errors: number;\n  running: number;\n  successful: number;\n  failed: number;\n  startTime: Date;\n  endTime?: Date;\n  message?: string;\n  detailsLoading?: boolean;\n}\n\nexport interface JobDetailsResponse {\n  jobId: string;\n  jobName: string;\n  status: \"pending\" | \"running\" | \"completed\";\n  progress: number;\n  total: number;\n  totalCount: number;\n  successCount: number;\n  failedCount: number;\n  runningCount: number;\n  pendingCount: number;\n  entries: JobDetailEntry[];\n}\n\nexport interface JobDetailEntry {\n  id: string;\n  itemName: string;\n  status: \"Success\" | \"Failed\" | \"Pending\";\n  errorMessage?: string;\n  details: string;\n  [key: string]: any; // Allow additional fields for entry data\n}\n\n// Injection tokens for pluggable dependencies\nexport const JOB_LOGGER_FACTORY = new InjectionToken<LoggerFactoryInterface>(\n  \"JOB_LOGGER_FACTORY\"\n);\n\n// Optional logger interfaces - only dependency we keep\nexport interface LoggerInterface {\n  debug(message: string, ...args: any[]): void;\n  error(message: string, ...args: any[]): void;\n  warn(message: string, ...args: any[]): void;\n}\n\nexport interface LoggerFactoryInterface {\n  createLogger(name: string): LoggerInterface;\n}\n\n/**\n * Configuration interface for job-based services\n */\nexport interface JobServiceConfig {\n  /** Service name for logging (e.g., 'Einladung', 'Erinnerung', 'Mahnung', 'Aufgabe', 'Medikamentenrueckforderung') */\n  serviceName: string;\n  /** API base path (e.g., '/bb/aktualisierung', '/medirueckforderung/medirueck') */\n  apiBasePath: string;\n  /** API endpoint name for processing (e.g., 'einladung', 'uploadMediRueckforderung') */\n  endpointName: string;\n  /** Search endpoint name (e.g., 'searchBBAktualisierungEinladung', 'searchMediRueckforderung') */\n  searchEndpointName: string;\n  /** Search Excel file endpoint name (e.g., 'searchExcelfile', 'searchMediRueckExcelfile') */\n  searchExcelFileEndpointName: string;\n  /** Translation key prefix for error messages (e.g., 'VT.BB.EINLADUNG', 'INEX.MEDIRUECK') */\n  translationPrefix: string;\n  /** Required columns for Excel validation */\n  requiredColumns: string[];\n  /** Translation key for row label in detail view */\n  rowTranslationKey: string;\n  /** Task name for overview searchExcelfile endpoint (e.g., 'invite', 'reminder', 'warning', 'task') - optional, not used by all services */\n  taskName?: string;\n}\n\n/**\n * Base interface for job entry types\n * All entry types must have these fields for the service to work\n */\nexport interface JobEntry {\n  id: number;\n  created: string;\n  updated: string;\n  updatedby: string;\n  excelfile: string;\n  status: string;\n  row: number;\n  partnernr?: string; // Optional - some services don't have this field\n  error?: string | null; // Optional - some services use 'message' instead\n  message?: string | null; // Error/info message\n  [key: string]: unknown; // Allow additional fields\n}\n\n/**\n * Abstract base service for job-based operations (BB Aktualisierung and Medikamentenr√ºckforderung).\n *\n * This service implements CLIENT-SIDE job tracking with session storage persistence.\n *\n * Backend Integration Pattern:\n * 1. POST /uploadfile - Upload Excel file\n * 2. PUT /bb/aktualisierung/{endpointName} or /medirueckforderung/{endpointName} - Trigger processing\n * 3. GET /bb/aktualisierung/searchExcelfile or /medirueckforderung/searchMedRueckforderung - Get job metadata\n * 4. GET /{searchEndpointName}?filename=xxx - Get entries/status\n *\n * Session Storage: Jobs are persisted to sessionStorage and restored on page refresh.\n */\nexport abstract class JobBaseService<TEntry extends JobEntry> {\n  protected http = inject(HttpClient);\n  protected translate = inject(TranslateService);\n  protected ngZone = inject(NgZone);\n  protected jobStore = inject(JobStore);\n\n  // Inject pluggable dependencies with fallbacks\n  protected logFactory = inject(JOB_LOGGER_FACTORY, { optional: true });\n  protected libraryConfig = inject(JOB_LIBRARY_CONFIG, { optional: true });\n  protected logger!: LoggerInterface;\n\n  protected apiUrl = `/api`;\n\n  // Session storage key for active jobs only - JobStore handles running/completed\n  protected readonly STORAGE_KEY_ACTIVE_JOBS: string;\n\n  // Store active jobs for polling\n  protected activeJobs = new Map<string, string>(); // jobId -> filename\n\n  // Cache for job entries to avoid redundant API calls\n  protected entriesCache = new Map<string, TEntry[]>(); // excelfile -> entries\n\n  // Track overview loading state for dashboard\n  private isLoadingOverviewSubject = new BehaviorSubject<boolean>(false);\n\n  // Track if overview has been loaded to prevent duplicate calls\n  private overviewLoadTriggered = false;\n  private overviewDataAvailable = false;\n\n  // Polling subscriptions for periodic updates\n  private pollingSubscription?: Subscription; // For completed jobs (10 minutes)\n  private runningJobsPollingSubscription?: Subscription; // For running jobs (30 seconds by default)\n\n  // Get polling intervals from config or use defaults\n  private get POLLING_INTERVAL_MS(): number {\n    return this.libraryConfig?.defaultPollingInterval ?? 600000; // 10 minutes default\n  }\n\n  private get RUNNING_JOBS_POLLING_INTERVAL_MS(): number {\n    return this.libraryConfig?.runningJobsPollingInterval ?? 30000; // 30 seconds default\n  }\n\n  // Track background detail loading subscriptions for cancellation\n  private backgroundLoadingSubscriptions: Subscription[] = [];\n  private backgroundLoadingCancelled = false;\n\n  // Subject to cancel ongoing HTTP requests when stopping polling or navigating\n  private cancelPendingRequests$ = new Subject<void>();\n\n  // Public Observable API for components (converted from JobStore Signals)\n  public readonly runningJobs$ = toObservable(\n    this.jobStore.runningJobs(this.getJobType())\n  );\n  public readonly completedJobs$ = toObservable(\n    this.jobStore.completedJobs(this.getJobType())\n  );\n  public readonly isLoadingOverview$ =\n    this.isLoadingOverviewSubject.asObservable();\n\n  /**\n   * Creates HTTP headers with X-Suppress-Error-Toast to prevent toast notifications\n   * from appearing during background polling operations\n   */\n  private createSuppressToastHeaders(): HttpHeaders {\n    const headers = new HttpHeaders({ \"X-Suppress-Error-Toast\": \"true\" });\n    return headers;\n  }\n\n  /**\n   * Each service must specify its JobType for JobStore integration\n   */\n  protected abstract getJobType(): JobType;\n\n  constructor(protected config: JobServiceConfig) {\n    // Initialize logger with fallback\n    if (this.logFactory) {\n      this.logger = this.logFactory.createLogger(\n        config.serviceName + \"Service\"\n      );\n    } else {\n      // Fallback logger if no logger factory is provided\n      this.logger = {\n        debug: (message: string, ...args: any[]) =>\n          console.debug(`[${config.serviceName}Service]`, message, ...args),\n        error: (message: string, ...args: any[]) =>\n          console.error(`[${config.serviceName}Service]`, message, ...args),\n        warn: (message: string, ...args: any[]) =>\n          console.warn(`[${config.serviceName}Service]`, message, ...args),\n      };\n    }\n\n    // Initialize storage keys based on service name\n    const lowerName = config.serviceName.toLowerCase();\n    this.STORAGE_KEY_ACTIVE_JOBS = `${lowerName}_active_jobs`;\n\n    // Load persisted state from sessionStorage on initialization\n    this.loadStateFromStorage();\n  }\n\n  /**\n   * Step 1: Upload Excel file to backend\n   * POST /uploadfile with multipart/form-data\n   */\n  protected uploadFile(file: File): Observable<string> {\n    const formData = new FormData();\n    formData.append(\"files\", file);\n\n    return this.http\n      .post<any>(`${this.apiUrl}/uploadfile`, formData, {\n        headers: this.createSuppressToastHeaders(),\n      })\n      .pipe(\n        map((response) => {\n          return response.filename || file.name;\n        }),\n        catchError((error) => {\n          this.logger.error(\"File upload failed:\", error);\n          return throwError(\n            () =>\n              new Error(\n                this.translate.instant(\n                  `${this.config.translationPrefix}.ERRORS.FILE_UPLOAD_FAILED`\n                )\n              )\n          );\n        })\n      );\n  }\n\n  /**\n   * Step 2: Trigger backend processing for the uploaded file\n   * PUT {apiBasePath}/{endpointName}?filename=xxx\n   */\n  protected triggerProcessing(\n    filename: string\n  ): Observable<{ excelfile: string; entries: TEntry[] }> {\n    const url = `${this.apiUrl}${this.config.apiBasePath}/${this.config.endpointName}`;\n\n    return this.http\n      .put<TEntry[]>(url, null, {\n        params: { filename },\n        headers: this.createSuppressToastHeaders(),\n      })\n      .pipe(\n        map((entries) => {\n          const excelfile =\n            entries.length > 0 ? entries[0].excelfile : filename;\n          this.logger.debug(\n            `Processing triggered. Excelfile: ${excelfile}, Entries: ${entries.length}`\n          );\n          this.entriesCache.set(excelfile, entries);\n          return { excelfile, entries };\n        }),\n        catchError((error) => {\n          this.logger.error(\"Processing trigger failed:\", error);\n          return throwError(\n            () =>\n              new Error(\n                this.translate.instant(\n                  `${this.config.translationPrefix}.ERRORS.PROCESSING_TRIGGER_FAILED`\n                )\n              )\n          );\n        })\n      );\n  }\n\n  /**\n   * Get job entries from backend\n   * GET /bb/aktualisierung/{searchEndpointName}?filename=xxx\n   */\n  protected getJobEntries(\n    excelfile: string,\n    useCache: boolean = true\n  ): Observable<TEntry[]> {\n    if (useCache && this.entriesCache.has(excelfile)) {\n      return of(this.entriesCache.get(excelfile)!);\n    }\n\n    const url = `${this.apiUrl}${this.config.apiBasePath}/${this.config.searchEndpointName}`;\n\n    return this.http\n      .get<TEntry[]>(url, {\n        params: { filename: excelfile },\n        headers: this.createSuppressToastHeaders(),\n      })\n      .pipe(\n        // Cancel this request if navigation occurs\n        takeUntil(this.cancelPendingRequests$),\n        map((entries) => {\n          this.entriesCache.set(excelfile, entries);\n          return entries;\n        }),\n        catchError((error) => {\n          this.logger.error(\n            `Error getting job entries for ${excelfile}:`,\n            error\n          );\n          return of([]);\n        })\n      );\n  }\n\n  /**\n   * Get all recent jobs by fetching all entries without filename filter\n   * Uses configured searchExcelFileEndpointName\n   */\n  protected getAllRecentJobs(): Observable<TEntry[]> {\n    const url = `${this.apiUrl}${this.config.apiBasePath}/${this.config.searchExcelFileEndpointName}`;\n\n    // Build params - only include taskName if it's defined\n    const params: Record<string, string> = { filename: \"\" };\n    if (this.config.taskName) {\n      params[\"task\"] = this.config.taskName;\n    }\n\n    return this.http\n      .get<TEntry[]>(url, {\n        params,\n        headers: this.createSuppressToastHeaders(),\n      })\n      .pipe(\n        // Cancel this request if navigation occurs\n        takeUntil(this.cancelPendingRequests$),\n        map((entries) => entries),\n        catchError((error) => {\n          this.logger.error(\"Error getting all recent jobs:\", error);\n          return of([]);\n        })\n      );\n  }\n\n  /**\n   * Calculate job progress from entries\n   */\n  protected calculateJobProgress(\n    entries: TEntry[],\n    jobId: string,\n    excelfile: string\n  ): JobProgress {\n    const total = entries.length;\n    const processed = entries.filter((e) => e.status === \"verarbeitet\").length;\n    const failed = entries.filter(\n      (e) => e.status === \"verarbeitet\" && e.error !== null && e.error !== \"\"\n    ).length;\n    const successful = processed - failed;\n\n    const progress = total > 0 ? (processed / total) * 100 : 0;\n    const status: \"running\" | \"completed\" | \"failed\" =\n      total > 0 && processed === total\n        ? failed === total\n          ? \"failed\"\n          : \"completed\"\n        : \"running\";\n\n    const startTime =\n      entries.length > 0 ? new Date(entries[0].created) : new Date();\n    const endTime =\n      status === \"completed\" || status === \"failed\"\n        ? new Date(entries[0].updated)\n        : undefined;\n\n    return {\n      id: jobId,\n      name: excelfile,\n      status,\n      progress: Math.round(progress),\n      total,\n      processed,\n      errors: failed,\n      running: status === \"running\" ? processed : 0,\n      successful,\n      failed,\n      startTime,\n      endTime,\n      message:\n        status === \"failed\"\n          ? `${failed} error(s) occurred during processing`\n          : undefined,\n    };\n  }\n\n  /**\n   * Get all currently running jobs by checking active job statuses\n   */\n  getRunningJobs(): Observable<JobProgress[]> {\n    if (this.activeJobs.size === 0) {\n      const emptyJobs: JobProgress[] = [];\n      this.jobStore.setRunningJobs(this.getJobType(), emptyJobs);\n      return of(emptyJobs);\n    }\n\n    const jobStatusObservables = Array.from(this.activeJobs.entries()).map(\n      ([jobId, excelfile]) =>\n        this.getJobEntries(excelfile, false).pipe(\n          // Cancel this request if navigation occurs\n          takeUntil(this.cancelPendingRequests$),\n          map((entries) => {\n            if (entries.length === 0) {\n              this.activeJobs.delete(jobId);\n              this.saveActiveJobsToStorage();\n              return null;\n            }\n            return this.calculateJobProgress(entries, jobId, excelfile);\n          }),\n          catchError(() => {\n            this.activeJobs.delete(jobId);\n            this.saveActiveJobsToStorage();\n            return of(null);\n          })\n        )\n    );\n\n    return new Observable((observer) => {\n      const jobs: JobProgress[] = [];\n      let completed = 0;\n\n      jobStatusObservables.forEach((obs) => {\n        obs.subscribe({\n          next: (job: JobProgress | null) => {\n            if (job) {\n              jobs.push(job);\n              if (job.status === \"completed\" || job.status === \"failed\") {\n                this.activeJobs.delete(job.id);\n                this.saveActiveJobsToStorage();\n              }\n            }\n          },\n          complete: () => {\n            completed++;\n            if (completed === jobStatusObservables.length) {\n              const runningJobs = jobs.filter((j) => j.status === \"running\");\n              this.jobStore.setRunningJobs(this.getJobType(), runningJobs);\n              observer.next(runningJobs);\n              observer.complete();\n            }\n          },\n          error: (err: Error) => observer.error(err),\n        });\n      });\n\n      if (jobStatusObservables.length === 0) {\n        const emptyJobs: JobProgress[] = [];\n        this.jobStore.setRunningJobs(this.getJobType(), emptyJobs);\n        observer.next(emptyJobs);\n        observer.complete();\n      }\n    });\n  }\n\n  /**\n   * Validate Excel data\n   */\n  validateExcelData(data: Record<string, unknown>[]): {\n    valid: boolean;\n    error?: string;\n  } {\n    if (!data || data.length === 0) {\n      return {\n        valid: false,\n        error: this.translate.instant(\"common.error.emptyFile\"),\n      };\n    }\n\n    const firstRow = data[0];\n    const missingColumns = this.config.requiredColumns.filter(\n      (col) => !(col in firstRow)\n    );\n\n    if (missingColumns.length > 0) {\n      return {\n        valid: false,\n        error: this.translate.instant(\"common.error.requiredColumns\", {\n          columns: missingColumns.join(\", \"),\n        }),\n      };\n    }\n\n    return { valid: true };\n  }\n\n  /**\n   * Process uploaded file and create job.\n   * The consuming component must parse the Excel data and validate it before calling this method.\n   *\n   * @param file - The Excel file to upload\n   * @param parsedData - Pre-parsed Excel data from the consuming component\n   */\n  processFileAndCreateJob(\n    file: File,\n    parsedData: Record<string, unknown>[]\n  ): Observable<JobProgress> {\n    const validation = this.validateExcelData(parsedData);\n\n    if (!validation.valid) {\n      this.logger.error(\"Validation failed:\", validation.error);\n      return throwError(\n        () => new Error(validation.error || \"Validation failed\")\n      );\n    }\n\n    return this.uploadFile(file).pipe(\n      switchMap((filename) => this.triggerProcessing(filename)),\n      switchMap((response) => {\n        const jobId = `${this.config.serviceName.toLowerCase()}-${Date.now()}-${Math.random()\n          .toString(36)\n          .substring(7)}`;\n        this.activeJobs.set(jobId, response.excelfile);\n        this.saveActiveJobsToStorage();\n\n        return this.pollJobStatus(response.excelfile, jobId);\n      }),\n      catchError((err: Error) => {\n        this.logger.error(`Error in ${this.config.serviceName} workflow:`, err);\n        const errorMessage =\n          err.message ||\n          this.translate.instant(\n            `${this.config.translationPrefix}.ERRORS.JOB_CREATION_FAILED`\n          );\n        return throwError(() => new Error(errorMessage));\n      })\n    );\n  }\n\n  /**\n   * Alternative method that accepts pre-validated data and filename.\n   * Use this when you want to bypass file upload (e.g., file already uploaded elsewhere).\n   *\n   * @param filename - The filename returned from a previous upload\n   * @param validatedData - Pre-validated Excel data from the consuming component\n   */\n  createJobFromUploadedFile(\n    filename: string,\n    validatedData: Record<string, unknown>[]\n  ): Observable<JobProgress> {\n    const validation = this.validateExcelData(validatedData);\n\n    if (!validation.valid) {\n      this.logger.error(\"Validation failed:\", validation.error);\n      return throwError(\n        () => new Error(validation.error || \"Validation failed\")\n      );\n    }\n\n    return this.triggerProcessing(filename).pipe(\n      switchMap((response) => {\n        const jobId = `${this.config.serviceName.toLowerCase()}-${Date.now()}-${Math.random()\n          .toString(36)\n          .substring(7)}`;\n        this.activeJobs.set(jobId, response.excelfile);\n        this.saveActiveJobsToStorage();\n\n        return this.pollJobStatus(response.excelfile, jobId);\n      }),\n      catchError((err: Error) => {\n        this.logger.error(`Error creating job from uploaded file:`, err);\n        const errorMessage =\n          err.message ||\n          this.translate.instant(\n            `${this.config.translationPrefix}.ERRORS.JOB_CREATION_FAILED`\n          );\n        return throwError(() => new Error(errorMessage));\n      })\n    );\n  }\n\n  /**\n   * Poll job status until it's no longer running\n   */\n  protected pollJobStatus(\n    excelfile: string,\n    jobId: string\n  ): Observable<JobProgress> {\n    return this.getJobEntries(excelfile).pipe(\n      map((entries) => this.calculateJobProgress(entries, jobId, excelfile)),\n      catchError((error: Error) => {\n        this.logger.error(\"Error polling job status:\", error);\n        return throwError(\n          () =>\n            new Error(\n              this.translate.instant(\n                `${this.config.translationPrefix}.ERRORS.STATUS_FETCH_FAILED`\n              )\n            )\n        );\n      })\n    );\n  }\n\n  /**\n   * Load job details by ID - to be implemented by subclasses\n   * Each service has slightly different field mappings for the detail view\n   */\n  abstract loadJobDetailsById(jobId: string): Observable<JobDetailsResponse>;\n\n  /**\n   * Map entry status to JobDetailEntry status\n   */\n  protected mapEntryStatus(entry: TEntry): \"Success\" | \"Failed\" | \"Pending\" {\n    if (entry.status === \"neu\") {\n      return \"Pending\";\n    }\n    if (entry.status === \"verarbeitet\") {\n      return entry.message && entry.message !== \"\" ? \"Failed\" : \"Success\";\n    }\n    return \"Pending\";\n  }\n\n  /**\n   * Start polling (simplified version for library)\n   */\n  startPolling(intervalMs: number = this.POLLING_INTERVAL_MS): void {\n    this.stopPolling();\n\n    this.ngZone.runOutsideAngular(() => {\n      this.logger.debug(`Starting polling (interval: ${intervalMs}ms)`);\n\n      this.pollingSubscription = timer(0, intervalMs)\n        .pipe(switchMap(() => this.getAllRecentJobs()))\n        .subscribe({\n          next: (jobs) => {\n            this.ngZone.run(() => {\n              // Basic polling implementation - can be extended\n              this.logger.debug(`Polled ${jobs.length} jobs`);\n            });\n          },\n          error: (error) => {\n            this.ngZone.run(() => {\n              this.logger.error(\"Polling error:\", error);\n            });\n          },\n        });\n    });\n  }\n\n  /**\n   * Stop polling\n   */\n\n  /**\n   * Load completed jobs overview from API (without fetching entry details)\n   * This method only fetches the job overview data, not individual entries.\n   * Use loadJobDetails() to fetch full entry data for a specific job on-demand.\n   */\n  loadCompletedJobs(): void {\n    this.logger.debug(\n      \"loadCompletedJobs() called - loading job overview only (no details)\"\n    );\n    this.isLoadingOverviewSubject.next(true);\n\n    this.getAllRecentJobs()\n      .pipe(\n        tap((entries: TEntry[]) =>\n          this.logger.debug(\n            `API returned ${entries.length} raw entries (overview only)`\n          )\n        ),\n        map((entries: TEntry[]) =>\n          this.processEntriesIntoCompletedJobs(entries)\n        ),\n        tap((jobs: JobProgress[]) =>\n          this.logger.debug(\n            `Processed into ${jobs.length} completed jobs (overview only)`,\n            jobs\n          )\n        ),\n        catchError((error) => {\n          this.logger.error(\"Failed to load completed jobs overview:\", error);\n          this.isLoadingOverviewSubject.next(false);\n          return of([]);\n        })\n      )\n      .subscribe((completedJobs: JobProgress[]) => {\n        // Update JobStore with completed jobs (overview only, details not loaded)\n        this.jobStore.setCompletedJobs(this.getJobType(), completedJobs);\n        this.logger.debug(\n          `Successfully loaded ${completedJobs.length} job overviews to store`\n        );\n        this.isLoadingOverviewSubject.next(false);\n      });\n  }\n\n  /**\n   * Load full job details (entries) for a specific job on-demand.\n   * This method is intended to be called when navigating to a job detail page.\n   * It fetches all entries for the specified job and caches them.\n   *\n   * @param jobId - The job ID or excelfile name to load details for\n   * @returns Observable that emits when details are loaded\n   */\n  loadJobDetails(jobId: string): Observable<void> {\n    this.logger.debug(`loadJobDetails() called for jobId: ${jobId}`);\n\n    // For jobIds that are sanitized (underscores), we need to find the original excelfile name\n    // Check if this is an active job first\n    const excelfile = this.activeJobs.get(jobId) || jobId;\n\n    this.logger.debug(`Loading full entry details for excelfile: ${excelfile}`);\n\n    return this.getJobEntries(excelfile, false).pipe(\n      map(() => {\n        this.logger.debug(\n          `Successfully loaded ${\n            this.entriesCache.get(excelfile)?.length || 0\n          } entries for ${excelfile}`\n        );\n        return undefined;\n      }),\n      catchError((error) => {\n        this.logger.error(`Failed to load job details for ${jobId}:`, error);\n        return of(undefined);\n      })\n    );\n  }\n\n  /**\n   * Process raw entries into completed JobProgress objects\n   */\n  private processEntriesIntoCompletedJobs(entries: TEntry[]): JobProgress[] {\n    this.logger.debug(\"Processing entries into completed jobs\", {\n      totalEntries: entries.length,\n    });\n    const jobGroups = new Map<string, TEntry[]>();\n\n    entries.forEach((entry) => {\n      if (!jobGroups.has(entry.excelfile)) {\n        jobGroups.set(entry.excelfile, []);\n      }\n      jobGroups.get(entry.excelfile)!.push(entry);\n    });\n\n    this.logger.debug(`Grouped into ${jobGroups.size} job groups`);\n    const completedJobs: JobProgress[] = [];\n\n    jobGroups.forEach((groupEntries, excelfile) => {\n      const jobId = excelfile.replace(/[^a-zA-Z0-9]/g, \"_\");\n      const jobProgress = this.calculateJobProgress(\n        groupEntries,\n        jobId,\n        excelfile\n      );\n\n      this.logger.debug(`Job ${excelfile} has status: ${jobProgress.status}`);\n      if (jobProgress.status === \"completed\") {\n        completedJobs.push(jobProgress);\n      }\n    });\n\n    const sortedJobs = completedJobs.sort((a, b) => {\n      const aTime = a.endTime || a.startTime;\n      const bTime = b.endTime || b.startTime;\n      return bTime.getTime() - aTime.getTime();\n    });\n\n    this.logger.debug(`Returning ${sortedJobs.length} sorted completed jobs`);\n    return sortedJobs;\n  }\n\n  stopPolling(): void {\n    if (this.pollingSubscription) {\n      this.logger.debug(\"Stopping job polling\");\n      this.cancelPendingRequests$.next();\n      this.pollingSubscription.unsubscribe();\n      this.pollingSubscription = undefined;\n    }\n  }\n\n  /**\n   * Start polling for running jobs progress updates.\n   *\n   * Runs OUTSIDE Angular zone to prevent:\n   * - Change detection on every poll cycle\n   * - Navigation blocking from pending HTTP requests\n   * - Performance overhead from Zone.js tracking\n   *\n   * @param intervalMs - Polling interval (default: 30000 = 30 seconds)\n   */\n  startRunningJobsPolling(\n    intervalMs: number = this.RUNNING_JOBS_POLLING_INTERVAL_MS\n  ): void {\n    this.stopRunningJobsPolling();\n\n    // Run polling OUTSIDE Angular zone for true background behavior\n    this.ngZone.runOutsideAngular(() => {\n      this.logger.debug(\n        `Starting running jobs polling OUTSIDE Angular zone (interval: ${intervalMs}ms)`\n      );\n\n      this.runningJobsPollingSubscription = timer(0, intervalMs)\n        .pipe(\n          takeUntil(this.cancelPendingRequests$),\n          switchMap(() => this.getRunningJobs())\n        )\n        .subscribe({\n          next: (runningJobs) => {\n            if (runningJobs.length > 0) {\n              this.ngZone.run(() => {\n                this.logger.debug(\n                  `Running jobs update: ${runningJobs.length} job(s)`\n                );\n              });\n            }\n          },\n          error: (error) => {\n            this.ngZone.run(() => {\n              this.logger.error(\"Running jobs polling error:\", error);\n            });\n          },\n        });\n    });\n  }\n\n  /**\n   * Stop polling for running jobs\n   */\n  stopRunningJobsPolling(): void {\n    if (this.runningJobsPollingSubscription) {\n      this.logger.debug(\"Stopping running jobs polling\");\n      this.cancelPendingRequests$.next();\n      this.runningJobsPollingSubscription.unsubscribe();\n      this.runningJobsPollingSubscription = undefined;\n    }\n  }\n\n  /**\n   * Clear the entries cache to free memory\n   */\n  clearEntriesCache(): void {\n    this.entriesCache.clear();\n  }\n\n  /**\n   * Clear cache entries for a specific Excel file\n   */\n  clearCacheForFile(excelfile: string): void {\n    this.entriesCache.delete(excelfile);\n  }\n\n  /**\n   * Save active jobs to sessionStorage\n   */\n  protected saveActiveJobsToStorage(): void {\n    try {\n      const activeJobsArray = Array.from(this.activeJobs.entries());\n      sessionStorage.setItem(\n        this.STORAGE_KEY_ACTIVE_JOBS,\n        JSON.stringify(activeJobsArray)\n      );\n    } catch (error) {\n      this.logger.error(\"Failed to save active jobs to storage:\", error);\n    }\n  }\n\n  // JobStore handles running/completed jobs session storage automatically\n\n  /**\n   * Load state from sessionStorage on service initialization\n   */\n  protected loadStateFromStorage(): void {\n    try {\n      const activeJobsData = sessionStorage.getItem(\n        this.STORAGE_KEY_ACTIVE_JOBS\n      );\n      if (activeJobsData) {\n        const activeJobsArray = JSON.parse(activeJobsData) as [\n          string,\n          string\n        ][];\n        this.activeJobs = new Map(activeJobsArray);\n      }\n\n      // JobStore handles its own session storage automatically\n    } catch (error) {\n      this.logger.error(\"Failed to load state from storage:\", error);\n    }\n  }\n\n  /**\n   * Clear all persisted state from sessionStorage\n   */\n  clearPersistedState(): void {\n    try {\n      sessionStorage.removeItem(this.STORAGE_KEY_ACTIVE_JOBS);\n      // JobStore clears its own state\n      this.jobStore.clearPersistedState();\n    } catch (error) {\n      this.logger.error(\"Failed to clear persisted state:\", error);\n    }\n  }\n}\n","import {\n    BehaviorSubject, Observable, of, Subject, Subscription, take, takeUntil, timer\n} from 'rxjs';\nimport { catchError, map, switchMap } from 'rxjs/operators';\n\nimport { inject, Injectable, NgZone } from '@angular/core';\n\nimport { JobDataProvider, JobEntry } from '../interfaces/job-provider.interface';\nimport { JOB_LOGGER_FACTORY, JobProgress, LoggerInterface } from './job-base.service';\n\n/**\n * JobStateService - Manages job state, polling, and sessionStorage persistence.\n *\n * This is a self-contained service that manages job states without external dependencies\n * beyond the pluggable logger factory.\n */\n@Injectable({\n    providedIn: 'root'\n})\nexport class JobStateService<TEntry extends JobEntry> {\n    private ngZone = inject(NgZone);\n\n    // Inject pluggable logger factory with fallback\n    private logFactory = inject(JOB_LOGGER_FACTORY, { optional: true });\n    private logger!: LoggerInterface;\n\n    // Session storage keys - constructed from service name\n    private STORAGE_KEY_ACTIVE_JOBS!: string;\n    private STORAGE_KEY_RUNNING_JOBS!: string;\n    private STORAGE_KEY_COMPLETED_JOBS!: string;\n\n    // Store active jobs for polling\n    private activeJobs = new Map<string, string>(); // jobId -> filename\n\n    // BehaviorSubjects for reactive state management\n    private runningJobsSubject = new BehaviorSubject<JobProgress[]>([]);\n    private completedJobsSubject = new BehaviorSubject<JobProgress[]>([]);\n\n    // Track overview loading state for dashboard\n    private isLoadingOverviewSubject = new BehaviorSubject<boolean>(false);\n\n    // Polling subscriptions for periodic updates\n    private pollingSubscription?: Subscription;\n    private readonly POLLING_INTERVAL_MS = 60000; // 60 seconds\n\n    // Track background detail loading subscriptions for cancellation\n    private backgroundLoadingSubscriptions: Subscription[] = [];\n\n    // Subject to cancel ongoing HTTP requests when stopping polling or navigating\n    private cancelPendingRequests$ = new Subject<void>();\n\n    // Public observables for components to subscribe to\n    public readonly runningJobs$ = this.runningJobsSubject.asObservable();\n    public readonly completedJobs$ = this.completedJobsSubject.asObservable();\n    public readonly isLoadingOverview$ = this.isLoadingOverviewSubject.asObservable();\n\n    // Data provider - injected after initialization\n    private dataProvider!: JobDataProvider<TEntry>;\n\n    /**\n     * Initialize the state service with a data provider\n     * @param dataProvider - The data provider to use for fetching job data\n     */\n    initialize(dataProvider: JobDataProvider<TEntry>): void {\n        this.dataProvider = dataProvider;\n        const config = dataProvider.getConfig();\n\n        // Initialize logger with fallback\n        if (this.logFactory) {\n            this.logger = this.logFactory.createLogger(config.serviceName + 'StateService');\n        } else {\n            // Fallback logger if no logger factory is provided\n            this.logger = {\n                debug: (message: string, ...args: any[]) => console.debug(`[${config.serviceName}StateService]`, message, ...args),\n                error: (message: string, ...args: any[]) => console.error(`[${config.serviceName}StateService]`, message, ...args),\n                warn: (message: string, ...args: any[]) => console.warn(`[${config.serviceName}StateService]`, message, ...args)\n            };\n        }\n\n        // Initialize storage keys based on service name\n        const lowerName = config.serviceName.toLowerCase();\n        this.STORAGE_KEY_ACTIVE_JOBS = `${lowerName}_active_jobs`;\n        this.STORAGE_KEY_RUNNING_JOBS = `${lowerName}_running_jobs`;\n        this.STORAGE_KEY_COMPLETED_JOBS = `${lowerName}_completed_jobs`;\n\n        // Load persisted state from sessionStorage on initialization\n        this.loadStateFromStorage();\n    }\n\n    /**\n     * Get active jobs map (for tracking running jobs)\n     */\n    getActiveJobs(): Map<string, string> {\n        return this.activeJobs;\n    }\n\n    /**\n     * Add an active job\n     * @param jobId - The job ID\n     * @param filename - The filename associated with this job\n     */\n    addActiveJob(jobId: string, filename: string): void {\n        this.activeJobs.set(jobId, filename);\n        this.saveActiveJobsToStorage();\n    }\n\n    /**\n     * Remove an active job\n     * @param jobId - The job ID to remove\n     */\n    removeActiveJob(jobId: string): void {\n        this.activeJobs.delete(jobId);\n        this.saveActiveJobsToStorage();\n    }\n\n    /**\n     * Calculate job progress from entries\n     */\n    calculateJobProgress(entries: TEntry[], jobId: string, excelfile: string): JobProgress {\n        const total = entries.length;\n        const processed = entries.filter((e) => e.status === 'verarbeitet').length;\n        const failed = entries.filter((e) => e.status === 'verarbeitet' && e.error !== null && e.error !== '').length;\n        const successful = processed - failed;\n\n        const progress = total > 0 ? (processed / total) * 100 : 0;\n        const status: 'running' | 'completed' | 'failed' = total > 0 && processed === total ? (failed === total ? 'failed' : 'completed') : 'running';\n\n        const startTime = entries.length > 0 ? new Date(entries[0].created) : new Date();\n        const endTime = status === 'completed' || status === 'failed' ? new Date(entries[0].updated) : undefined;\n\n        return {\n            id: jobId,\n            name: excelfile,\n            status,\n            progress: Math.round(progress),\n            total,\n            processed,\n            errors: failed,\n            running: status === 'running' ? processed : 0,\n            successful,\n            failed,\n            startTime,\n            endTime,\n            message: status === 'failed' ? `${failed} error(s) occurred during processing` : undefined\n        };\n    }\n\n    /**\n     * Get all currently running jobs by checking active job statuses\n     */\n    getRunningJobs(): Observable<JobProgress[]> {\n        if (this.activeJobs.size === 0) {\n            const emptyJobs: JobProgress[] = [];\n            this.runningJobsSubject.next(emptyJobs);\n            this.saveRunningJobsToStorage(emptyJobs);\n            return of(emptyJobs);\n        }\n\n        const jobStatusObservables = Array.from(this.activeJobs.entries()).map(([jobId, excelfile]) =>\n            this.dataProvider.getJobEntries(excelfile, false).pipe(\n                takeUntil(this.cancelPendingRequests$),\n                map((entries) => {\n                    if (entries.length === 0) {\n                        this.removeActiveJob(jobId);\n                        return null;\n                    }\n                    return this.calculateJobProgress(entries, jobId, excelfile);\n                }),\n                catchError(() => {\n                    this.removeActiveJob(jobId);\n                    return of(null);\n                })\n            )\n        );\n\n        return new Observable((observer) => {\n            const jobs: JobProgress[] = [];\n            let completed = 0;\n\n            jobStatusObservables.forEach((obs) => {\n                obs.subscribe({\n                    next: (job: JobProgress | null) => {\n                        if (job) {\n                            jobs.push(job);\n                            if (job.status === 'completed' || job.status === 'failed') {\n                                this.removeActiveJob(job.id);\n                            }\n                        }\n                    },\n                    complete: () => {\n                        completed++;\n                        if (completed === jobStatusObservables.length) {\n                            const runningJobs = jobs.filter((j) => j.status === 'running');\n                            this.runningJobsSubject.next(runningJobs);\n                            this.saveRunningJobsToStorage(runningJobs);\n                            observer.next(runningJobs);\n                            observer.complete();\n                        }\n                    },\n                    error: (err: Error) => observer.error(err)\n                });\n            });\n\n            if (jobStatusObservables.length === 0) {\n                const emptyJobs: JobProgress[] = [];\n                this.runningJobsSubject.next(emptyJobs);\n                this.saveRunningJobsToStorage(emptyJobs);\n                observer.next(emptyJobs);\n                observer.complete();\n            }\n        });\n    }\n\n    /**\n     * Start basic polling\n     */\n    startPolling(intervalMs: number = this.POLLING_INTERVAL_MS): void {\n        this.stopPolling();\n\n        this.ngZone.runOutsideAngular(() => {\n            this.logger.debug(`Starting polling (interval: ${intervalMs}ms)`);\n\n            this.pollingSubscription = timer(0, intervalMs)\n                .pipe(switchMap(() => this.dataProvider.getAllRecentJobs()))\n                .subscribe({\n                    next: (jobs) => {\n                        this.ngZone.run(() => {\n                            this.logger.debug(`Polled ${jobs.length} jobs`);\n                        });\n                    },\n                    error: (error) => {\n                        this.ngZone.run(() => {\n                            this.logger.error('Polling error:', error);\n                        });\n                    }\n                });\n        });\n    }\n\n    /**\n     * Stop polling\n     */\n    stopPolling(): void {\n        if (this.pollingSubscription) {\n            this.logger.debug('Stopping job polling');\n            this.cancelPendingRequests$.next();\n            this.cancelBackgroundLoadingSubscriptions();\n            this.pollingSubscription.unsubscribe();\n            this.pollingSubscription = undefined;\n        }\n    }\n\n    /**\n     * Cancel background loading subscriptions\n     */\n    private cancelBackgroundLoadingSubscriptions(): void {\n        this.backgroundLoadingSubscriptions.forEach((sub) => sub.unsubscribe());\n        this.backgroundLoadingSubscriptions = [];\n    }\n\n    /**\n     * Cancel pending requests\n     */\n    cancelPendingRequests(): void {\n        this.cancelPendingRequests$.next();\n    }\n\n    // ==================== SessionStorage Methods ====================\n\n    /**\n     * Save active jobs to sessionStorage\n     */\n    private saveActiveJobsToStorage(): void {\n        try {\n            const activeJobsArray = Array.from(this.activeJobs.entries());\n            sessionStorage.setItem(this.STORAGE_KEY_ACTIVE_JOBS, JSON.stringify(activeJobsArray));\n        } catch (error) {\n            this.logger.error('Failed to save active jobs to storage:', error);\n        }\n    }\n\n    /**\n     * Save running jobs to sessionStorage\n     */\n    private saveRunningJobsToStorage(jobs: JobProgress[]): void {\n        try {\n            sessionStorage.setItem(this.STORAGE_KEY_RUNNING_JOBS, JSON.stringify(jobs));\n        } catch (error) {\n            this.logger.error('Failed to save running jobs to storage:', error);\n        }\n    }\n\n    /**\n     * Save completed jobs to sessionStorage\n     */\n    private saveCompletedJobsToStorage(jobs: JobProgress[]): void {\n        try {\n            sessionStorage.setItem(this.STORAGE_KEY_COMPLETED_JOBS, JSON.stringify(jobs));\n        } catch (error) {\n            this.logger.error('Failed to save completed jobs to storage:', error);\n        }\n    }\n\n    /**\n     * Load state from sessionStorage on service initialization\n     */\n    private loadStateFromStorage(): void {\n        try {\n            const activeJobsData = sessionStorage.getItem(this.STORAGE_KEY_ACTIVE_JOBS);\n            if (activeJobsData) {\n                const activeJobsArray = JSON.parse(activeJobsData) as [string, string][];\n                this.activeJobs = new Map(activeJobsArray);\n            }\n\n            const runningJobsData = sessionStorage.getItem(this.STORAGE_KEY_RUNNING_JOBS);\n            if (runningJobsData) {\n                const runningJobs = JSON.parse(runningJobsData) as JobProgress[];\n                runningJobs.forEach((job) => {\n                    job.startTime = new Date(job.startTime);\n                    if (job.endTime) job.endTime = new Date(job.endTime);\n                });\n                this.runningJobsSubject.next(runningJobs);\n            }\n\n            const completedJobsData = sessionStorage.getItem(this.STORAGE_KEY_COMPLETED_JOBS);\n            if (completedJobsData) {\n                const completedJobs = JSON.parse(completedJobsData) as JobProgress[];\n                completedJobs.forEach((job) => {\n                    job.startTime = new Date(job.startTime);\n                    if (job.endTime) job.endTime = new Date(job.endTime);\n                });\n                this.completedJobsSubject.next(completedJobs);\n            }\n        } catch (error) {\n            this.logger.error('Failed to load state from storage:', error);\n        }\n    }\n\n    /**\n     * Clear all persisted state from sessionStorage\n     */\n    clearPersistedState(): void {\n        try {\n            sessionStorage.removeItem(this.STORAGE_KEY_ACTIVE_JOBS);\n            sessionStorage.removeItem(this.STORAGE_KEY_RUNNING_JOBS);\n            sessionStorage.removeItem(this.STORAGE_KEY_COMPLETED_JOBS);\n        } catch (error) {\n            this.logger.error('Failed to clear persisted state:', error);\n        }\n    }\n}\n","import { Subscription } from 'rxjs';\nimport { filter } from 'rxjs/operators';\n\nimport { inject, Injectable, InjectionToken, Injector, OnDestroy } from '@angular/core';\nimport { NavigationStart, Router } from '@angular/router';\n\nimport { JOB_LIBRARY_CONFIG, JobLibraryConfig } from '../config/job-tokens';\nimport { JOB_LOGGER_FACTORY, LoggerInterface } from './job-base.service';\n\n/**\n * Configuration for a registered job service\n */\nexport interface JobServiceConfig {\n  /** Unique identifier for the service */\n  name: string;\n  /** Display name for logging */\n  displayName: string;\n  /** Service class constructor/token for dependency injection */\n  serviceClass: any;\n  /** Required roles to access this service */\n  requiredRoles?: string[];\n}\n\n/**\n * Simplified job polling service for the library.\n * This service manages polling lifecycle for multiple job services.\n */\n@Injectable({\n  providedIn: \"root\",\n})\nexport class JobPollingService implements OnDestroy {\n  // Inject pluggable dependencies with fallbacks\n  private logFactory = inject(JOB_LOGGER_FACTORY, { optional: true });\n  private libraryConfig = inject(JOB_LIBRARY_CONFIG, { optional: true });\n  private router = inject(Router, { optional: true });\n  private injector = inject(Injector);\n  private logger!: LoggerInterface;\n\n  // Service instances - injected directly (not lazy-loaded)\n  private serviceInstances = new Map<string, any>();\n\n  // Registered service configurations (populated by feature modules)\n  private registeredServices: JobServiceConfig[] = [];\n\n  private isPollingStarted = false;\n  private navigationSubscription?: Subscription;\n\n  constructor() {\n    // Initialize logger with fallback\n    if (this.logFactory) {\n      this.logger = this.logFactory.createLogger(\"JobPollingService\");\n    } else {\n      this.logger = {\n        debug: (message: string, ...args: any[]) =>\n          console.debug(\"[JobPollingService]\", message, ...args),\n        error: (message: string, ...args: any[]) =>\n          console.error(\"[JobPollingService]\", message, ...args),\n        warn: (message: string, ...args: any[]) =>\n          console.warn(\"[JobPollingService]\", message, ...args),\n      };\n    }\n\n    // Setup navigation listener if router is available\n    this.setupNavigationListener();\n  }\n\n  /**\n   * Register a job service for polling.\n   * Should be called by feature modules during initialization.\n   *\n   * @param config - Service configuration\n   */\n  registerJobService(config: JobServiceConfig): void {\n    this.logger.debug(`Registering job service: ${config.displayName}`);\n    this.registeredServices.push(config);\n\n    // If polling already started, start polling for this new service immediately\n    if (this.isPollingStarted) {\n      this.startPollingForService(config, 600000);\n    }\n  }\n\n  /**\n   * Get or create a service instance from the registry\n   */\n  private getServiceInstance(config: JobServiceConfig): any {\n    if (!this.serviceInstances.has(config.name)) {\n      const instance = this.injector.get(config.serviceClass);\n      this.serviceInstances.set(config.name, instance);\n    }\n    return this.serviceInstances.get(config.name);\n  }\n\n  /**\n   * Initialize polling for all authorized job services.\n   *\n   * @returns Promise that resolves when polling is set up\n   */\n  async initializePolling(): Promise<void> {\n    if (this.isPollingStarted) {\n      this.logger.debug(\"Polling already started, skipping initialization\");\n      return;\n    }\n\n    this.logger.debug(\"Initializing job polling service...\");\n    this.startPollingForAuthorizedServices();\n  }\n\n  /**\n   * Setup navigation listener to cancel pending HTTP requests.\n   * This prevents navigation delays caused by pending polling requests.\n   */\n  private setupNavigationListener(): void {\n    if (!this.router) {\n      return; // No router available\n    }\n\n    this.navigationSubscription = this.router.events\n      .pipe(filter((event) => event instanceof NavigationStart))\n      .subscribe(() => {\n        this.logger.debug(\n          \"Navigation detected, cancelling pending HTTP requests\"\n        );\n        this.cancelAllPendingRequests();\n      });\n  }\n\n  /**\n   * Cancel pending HTTP requests in all services.\n   * Called automatically on navigation to prevent blocking.\n   */\n  private cancelAllPendingRequests(): void {\n    this.logger.debug(\"Cancelling all pending HTTP requests for navigation\");\n\n    // Stop all polling and cancel requests in all cached service instances\n    for (const [name, service] of this.serviceInstances) {\n      if (service.stopPolling) service.stopPolling();\n      if (service.stopRunningJobsPolling) service.stopRunningJobsPolling();\n    }\n\n    // Restart polling after navigation completes\n    setTimeout(() => {\n      if (this.isPollingStarted) {\n        this.logger.debug(\"Restarting polling after navigation\");\n        this.startPollingForAuthorizedServices();\n      }\n    }, 1000);\n  }\n\n  /**\n   * Start polling for all registered services.\n   * Authorization is handled by consuming components.\n   *\n   * @param intervalMs - Polling interval (default: 600000ms = 10 minutes)\n   */\n  private startPollingForAuthorizedServices(intervalMs: number = 600000): void {\n    this.logger.debug(\"Starting polling for all registered job services...\");\n\n    const registeredServiceNames: string[] = [];\n\n    // Start polling for all registered services\n    this.registeredServices.forEach((config: JobServiceConfig) => {\n      registeredServiceNames.push(config.name);\n      this.startPollingForService(config, intervalMs);\n    });\n\n    this.isPollingStarted = true;\n    this.logger.debug(\n      `Polling started for ${registeredServiceNames.length} services:`,\n      registeredServiceNames\n    );\n  }\n\n  /**\n   * Start polling for a specific service.\n   *\n   * @param config - Service configuration from registry\n   * @param intervalMs - Polling interval for completed jobs\n   */\n  private startPollingForService(\n    config: JobServiceConfig,\n    intervalMs: number\n  ): void {\n    this.logger.debug(`Starting polling for ${config.displayName}`);\n\n    const service = this.getServiceInstance(config);\n    if (service.startPolling) service.startPolling(intervalMs);\n    // Start running jobs polling with configured interval (default 30 seconds)\n    const runningJobsInterval =\n      this.libraryConfig?.runningJobsPollingInterval ?? 30000;\n    if (service.startRunningJobsPolling) {\n      this.logger.debug(\n        `Starting running jobs polling for ${config.displayName} (interval: ${runningJobsInterval}ms)`\n      );\n      service.startRunningJobsPolling(runningJobsInterval);\n    }\n  }\n\n  /**\n   * Stop polling for all services.\n   * Useful for cleanup (e.g., user logout).\n   */\n  stopAllPolling(): void {\n    this.logger.debug(\"Stopping all job polling\");\n\n    // Stop all polling in all cached service instances\n    for (const [name, service] of this.serviceInstances) {\n      if (service.stopPolling) service.stopPolling();\n      if (service.stopRunningJobsPolling) service.stopRunningJobsPolling();\n    }\n\n    this.isPollingStarted = false;\n  }\n\n  /**\n   * Resume polling for all registered services.\n   * Restarts polling if it was previously stopped.\n   *\n   * @param intervalMs - Optional polling interval (default: 600000ms = 10 minutes)\n   */\n  resumePolling(intervalMs: number = 600000): void {\n    if (!this.isPollingStarted) {\n      this.logger.debug(\"Resuming job polling\");\n      this.startPollingForAuthorizedServices(intervalMs);\n    } else {\n      this.logger.debug(\"Polling already started, skipping resume\");\n    }\n  }\n\n  /**\n   * Cleanup on service destruction\n   */\n  ngOnDestroy(): void {\n    this.logger.debug(\"JobPollingService destroyed, cleaning up\");\n    this.stopAllPolling();\n\n    if (this.navigationSubscription) {\n      this.navigationSubscription.unsubscribe();\n    }\n  }\n}\n","import { CommonModule } from \"@angular/common\";\nimport { Component, EventEmitter, Input, OnInit, Output } from \"@angular/core\";\n\nimport {\n  JobDetailEntry,\n  JobDetailsResponse,\n} from \"../../interfaces/job-detail.interface\";\n\n@Component({\n  selector: \"syr-job-details\",\n  standalone: true,\n  imports: [CommonModule],\n  templateUrl: \"./job-details.component.html\",\n})\nexport class JobDetailsComponent implements OnInit {\n  @Input() jobDetails: JobDetailsResponse | null = null;\n  @Input() isLoading: boolean = false;\n  @Output() refresh = new EventEmitter<void>();\n\n  ngOnInit(): void {\n    // Component initialization\n  }\n\n  onRefresh(): void {\n    this.refresh.emit();\n  }\n}\n","<div class=\"p-4 border border-gray-300 rounded-lg bg-white\">\n  <div\n    class=\"flex justify-between items-center mb-4 pb-2 border-b border-gray-300\"\n  >\n    <h3 class=\"m-0 text-gray-800\">\n      {{ jobDetails?.jobName || \"Job Details\" }}\n    </h3>\n    <div\n      class=\"px-3 py-1 rounded-full text-xs font-bold uppercase\"\n      [ngClass]=\"{\n        'bg-yellow-100 text-yellow-700': jobDetails?.status === 'pending',\n        'bg-blue-100 text-blue-700': jobDetails?.status === 'running',\n        'bg-green-100 text-green-700': jobDetails?.status === 'completed'\n      }\"\n    >\n      {{ jobDetails?.status | titlecase }}\n    </div>\n  </div>\n\n  <div class=\"flex gap-6 mb-6 flex-wrap\" *ngIf=\"jobDetails\">\n    <div class=\"flex flex-col gap-1\">\n      <span class=\"text-xs text-gray-600 font-medium\">Progress:</span>\n      <span class=\"text-lg font-bold\">{{ jobDetails.progress }}%</span>\n    </div>\n    <div class=\"flex flex-col gap-1\">\n      <span class=\"text-xs text-gray-600 font-medium\">Total:</span>\n      <span class=\"text-lg font-bold\">{{ jobDetails.total }}</span>\n    </div>\n    <div class=\"flex flex-col gap-1\">\n      <span class=\"text-xs text-gray-600 font-medium\">Success:</span>\n      <span class=\"text-lg font-bold text-green-600\">{{\n        jobDetails.successCount\n      }}</span>\n    </div>\n    <div class=\"flex flex-col gap-1\">\n      <span class=\"text-xs text-gray-600 font-medium\">Failed:</span>\n      <span class=\"text-lg font-bold text-red-600\">{{\n        jobDetails.failedCount\n      }}</span>\n    </div>\n    <div class=\"flex flex-col gap-1\">\n      <span class=\"text-xs text-gray-600 font-medium\">Pending:</span>\n      <span class=\"text-lg font-bold text-yellow-500\">{{\n        jobDetails.pendingCount\n      }}</span>\n    </div>\n  </div>\n\n  <div *ngIf=\"jobDetails?.entries?.length\">\n    <h4 class=\"m-0 mb-4 text-gray-800\">Job Entries</h4>\n    <div class=\"max-h-96 overflow-y-auto\">\n      <div\n        *ngFor=\"let entry of jobDetails?.entries\"\n        class=\"p-3 mb-2 border border-gray-300 rounded-md bg-gray-50\"\n        [ngClass]=\"{\n          'border-l-4 border-l-green-500':\n            entry.status.toLowerCase() === 'success',\n          'border-l-4 border-l-red-500':\n            entry.status.toLowerCase() === 'failed',\n          'border-l-4 border-l-yellow-500':\n            entry.status.toLowerCase() === 'pending',\n          'border-l-4 border-l-blue-500':\n            entry.status.toLowerCase() === 'running'\n        }\"\n      >\n        <div\n          class=\"flex justify-between items-center mb-2 md:flex-row flex-col md:gap-0 gap-2 md:items-center items-start\"\n        >\n          <span class=\"font-medium text-gray-800\">{{ entry.itemName }}</span>\n          <span\n            class=\"px-2 py-1 rounded-xl text-xs font-bold uppercase\"\n            [ngClass]=\"{\n              'bg-green-100 text-green-700':\n                entry.status.toLowerCase() === 'success',\n              'bg-red-100 text-red-800':\n                entry.status.toLowerCase() === 'failed',\n              'bg-yellow-100 text-yellow-700':\n                entry.status.toLowerCase() === 'pending',\n              'bg-blue-100 text-blue-700':\n                entry.status.toLowerCase() === 'running'\n            }\"\n          >\n            {{ entry.status }}\n          </span>\n        </div>\n\n        <div class=\"text-sm text-gray-600 mb-2\" *ngIf=\"entry.details\">\n          {{ entry.details }}\n        </div>\n\n        <div\n          class=\"bg-red-100 text-red-800 p-2 rounded text-sm mb-2\"\n          *ngIf=\"entry.errorMessage\"\n        >\n          <strong>Error:</strong> {{ entry.errorMessage }}\n        </div>\n\n        <div\n          class=\"text-gray-500 text-xs\"\n          *ngIf=\"entry.startTime || entry.endTime\"\n        >\n          <small>\n            <span *ngIf=\"entry.startTime\"\n              >Started: {{ entry.startTime | date : \"short\" }}</span\n            >\n            <span *ngIf=\"entry.endTime\">\n              | Ended: {{ entry.endTime | date : \"short\" }}</span\n            >\n            <span *ngIf=\"entry.duration\">\n              | Duration: {{ entry.duration }}ms</span\n            >\n          </small>\n        </div>\n      </div>\n    </div>\n  </div>\n\n  <div\n    class=\"text-center py-8 text-gray-600\"\n    *ngIf=\"\n      jobDetails && (!jobDetails.entries || jobDetails.entries.length === 0)\n    \"\n  >\n    <p>No job entries available.</p>\n  </div>\n\n  <div class=\"text-center py-8 text-gray-600\" *ngIf=\"isLoading\">\n    <p>Loading job details...</p>\n  </div>\n</div>\n","/*\n * Public API Surface of @syrius/job-service\n */\n\n// Main service\nexport {\n  JobBaseService,\n  JOB_LOGGER_FACTORY,\n} from \"./lib/services/job-base.service\";\n\nexport type {\n  JobServiceConfig,\n  JobEntry,\n  JobProgress,\n  JobDetailsResponse,\n  JobDetailEntry,\n  LoggerInterface,\n  LoggerFactoryInterface,\n} from \"./lib/services/job-base.service\";\n\n// State management\nexport { JobStateService } from \"./lib/services/job-state.service\";\nexport { JobStore } from \"./lib/stores/job.store\";\nexport type { JobType, JobTypeState, JobState } from \"./lib/stores/job.store\";\n\n// Polling service\nexport { JobPollingService } from \"./lib/services/job-polling.service\";\n\n// Data provider interface (different from job-base service interfaces)\nexport type {\n  JobDataProvider,\n  JobDataProviderConfig,\n} from \"./lib/interfaces/job-provider.interface\";\n\n// Components\nexport { JobDetailsComponent } from \"./lib/components/job-details/job-details.component\";\n\n// Configuration tokens\nexport { JOB_LIBRARY_CONFIG } from \"./lib/config/job-tokens\";\n\nexport type { JobLibraryConfig } from \"./lib/config/job-tokens\";\n","/**\n * Generated bundle index. Do not edit.\n */\n\nexport * from './public-api';\n"],"names":["JobStore"],"mappings":"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"}